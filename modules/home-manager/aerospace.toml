start-at-login = true

# --- Mouse Behavior ---
on-focused-monitor-changed = [ 'move-mouse monitor-lazy-center' ]
on-focus-changed           = [ 'move-mouse window-lazy-center' ]

# --- Layout Gaps ---
[gaps]
    inner.horizontal = 10
    inner.vertical   = 10
    outer.left       = 10
    outer.bottom     = 10
    outer.top        = 10
    outer.right      = 10

# --- Key Bindings: Main Mode ---
[mode.main.binding]

    # Applications & Terminal
    cmd-backslash = 'exec-and-forget /etc/profiles/per-user/zhao/bin/alacritty'

    cmd-e = """exec-and-forget /etc/profiles/per-user/zhao/bin/alacritty \
        --title vifm \
        -e /etc/profiles/per-user/zhao/bin/vifm ~/ ~/iCloud \
        -c "filter Applications|Desktop|Documents|Library|Movies|Music|Pictures | normal ggvGgA""""

    cmd-g = """exec-and-forget /etc/profiles/per-user/zhao/bin/alacritty \
        --title git \
        --option "window.dimensions={columns=100,lines=35}" \
        --option "window.position={x=525,y=250}" \
        -e zsh -ic "~/iCloud/Dotfiles/modules/home-manager/git.sh" """

    cmd-enter = [
        """exec-and-forget /etc/profiles/per-user/zhao/bin/alacritty \
            --config-file ~/.config/alacritty/launcher.toml \
            --title launcher \
            -e zsh -ic /etc/profiles/per-user/zhao/bin/launcher""",
        'mode launcher'
    ]

    cmd-w       = [ 'workspace w', 'exec-and-forget open -a qutebrowser' ]
    cmd-m       = [ 'workspace m', 'exec-and-forget open -a messages' ]
    cmd-shift-m = [ 'workspace M', 'exec-and-forget open -a music' ]
    cmd-s       = [ 'workspace 1', 'exec-and-forget open -a settings' ]
    cmd-p       = 'exec-and-forget screencapture ~/Downloads/Screenshot_$(date +%Y_%m_%d_%H%M%S).png'

    # Focus Movement
    cmd-h = 'focus left'
    cmd-j = 'focus down'
    cmd-k = 'focus up'
    cmd-l = 'focus right'

    # Node Movement
    cmd-shift-h = 'move left'
    cmd-shift-j = 'move down'
    cmd-shift-k = 'move up'
    cmd-shift-l = 'move right'

    # Workspace Switching
    cmd-1 = 'workspace 1'
    cmd-2 = 'workspace 2'
    cmd-3 = 'workspace 3'
    cmd-4 = 'workspace 4'
    cmd-5 = 'workspace 5'
    cmd-6 = 'workspace 6'
    cmd-7 = 'workspace 7'
    cmd-8 = 'workspace 8'
    cmd-9 = 'workspace 9'

    # Move Node to Workspace
    cmd-shift-1 = 'move-node-to-workspace 1'
    cmd-shift-2 = 'move-node-to-workspace 2'
    cmd-shift-3 = 'move-node-to-workspace 3'
    cmd-shift-4 = 'move-node-to-workspace 4'
    cmd-shift-5 = 'move-node-to-workspace 5'
    cmd-shift-6 = 'move-node-to-workspace 6'
    cmd-shift-7 = 'move-node-to-workspace 7'
    cmd-shift-8 = 'move-node-to-workspace 8'
    cmd-shift-9 = 'move-node-to-workspace 9'

    # Layout Controls
    cmd-f       = 'layout v_accordion v_tiles'
    cmd-tab     = 'focus --boundaries workspace --boundaries-action wrap-around-the-workspace dfs-next'
    cmd-shift-f = 'fullscreen --no-outer-gaps'

    # Modes & System
    cmd-r   = 'mode resize'
    cmd-q   = []
    cmd-esc = [
        'exec-and-forget osascript -e "tell application (path to frontmost application as text) to quit"',
        'focus --boundaries workspace dfs-next' 
    ]

# --- Key Bindings: Launcher Mode ---
[mode.launcher.binding]
    cmd-esc = [ 'exec-and-forget osascript -e "tell application (path to frontmost application as text) to quit"', 'mode main' ]
    ctrl-q  = [ 'exec-and-forget osascript -e "tell application (path to frontmost application as text) to quit"', 'mode main' ]
    cmd-q   = [ 'exec-and-forget osascript -e "tell application (path to frontmost application as text) to quit"', 'mode main' ]
    esc     = [ 'exec-and-forget osascript -e "tell application (path to frontmost application as text) to quit"', 'mode main' ]

# --- Key Bindings: Resize Mode ---
[mode.resize.binding]
    cmd-h = 'join-with left'
    cmd-j = 'join-with down'
    cmd-k = 'join-with up'
    cmd-l = 'join-with right'

    cmd-shift-h = []
    cmd-shift-l = []
    cmd-shift-j = 'resize smart -50'
    cmd-shift-k = 'resize smart +50'

    cmd-r = 'mode main'
    cmd-q = 'mode main'
    esc   = 'mode main'

# --- Window Detection Rules ---
[[on-window-detected]]
    if.app-id = 'com.apple.systempreferences'
    run = [ 'layout floating', 'move-node-to-workspace 1' ]

[[on-window-detected]]
    if.app-id = 'org.nixos.qutebrowser'
    run = [
        'layout tiling',
        'move-node-to-workspace w',
        'fullscreen'
    ]

[[on-window-detected]]
    if.app-id = 'com.apple.MobileSMS'
    run = 'move-node-to-workspace m'

[[on-window-detected]]
    if.app-id = 'com.apple.Music'
    run = 'move-node-to-workspace M'

[[on-window-detected]]
    if.window-title-regex-substring = 'vifm-float'
    run = 'layout floating'

[[on-window-detected]]
    if.window-title-regex-substring = 'git'
    run = 'layout floating'

[[on-window-detected]]
    if.window-title-regex-substring = 'launcher'
    run = 'layout floating'

[[on-window-detected]]
    if.window-title-regex-substring = 'zathura'
    run = 'fullscreen'
